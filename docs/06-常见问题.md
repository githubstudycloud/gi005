# 06 常见问题

## 安装问题

### Q1: pip 安装超时

```bash
# 使用国内镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple --timeout 120
```

### Q2: ModuleNotFoundError: No module named 'TTS'

需要 Visual C++ Build Tools:
1. 下载: https://visualstudio.microsoft.com/visual-cpp-build-tools/
2. 选择 "使用 C++ 的桌面开发"
3. 重新安装: `pip install TTS`

### Q3: CUDA 不可用

```bash
# 检查版本
nvidia-smi
nvcc --version

# 重装 PyTorch
pip uninstall torch torchaudio
pip install torch torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### Q4: cublas64_12.dll 找不到

CUDA 版本不匹配，降级 ctranslate2:
```bash
pip install ctranslate2==4.4.0
```

### Q5: transformers 版本冲突

```bash
pip install "transformers<4.50"
```

---

## 模型问题

### Q6: 模型加载失败

检查模型路径:
```bash
python -c "from src.common.paths import verify_model_paths; print(verify_model_paths())"
```

确认模型已解压到 `packages/models/*/extracted/` 目录。

### Q7: HuggingFace 下载慢

```bash
# 使用镜像
export HF_ENDPOINT=https://hf-mirror.com

# 或使用代理
export HTTP_PROXY=http://proxy:port
export HTTPS_PROXY=http://proxy:port
```

---

## 运行问题

### Q8: FFmpeg 找不到

**Windows:**
- 检查 `packages/tools/extracted/` 是否有 ffmpeg.exe
- 或添加到系统 PATH

**Linux:**
```bash
sudo apt install ffmpeg
```

### Q9: 内存不足

使用 CPU 模式:
```bash
python -m src.main standalone --engine xtts --device cpu
```

### Q10: WebSocket 连接失败 (404)

安装 websockets 库:
```bash
pip install websockets
# 或
pip install 'uvicorn[standard]'
```

### Q11: Windows 中文编码错误

设置环境变量:
```bash
set PYTHONIOENCODING=utf-8
```

---

## 合成问题

### Q12: 音频太短

参考音频要求:
- 时长: 5-30 秒
- 质量: 清晰无噪音
- 格式: WAV 推荐

### Q13: 合成质量差

1. 使用更长的参考音频 (10-20秒)
2. 确保参考音频清晰
3. 尝试不同引擎 (GPT-SoVITS 中文最好)

### Q14: 语速不对

调整 speed 参数:
```json
{"text": "...", "voice_id": "...", "speed": 0.8}
```

---

## 分布式问题

### Q15: Worker 注册失败

1. 确认 Gateway 已启动
2. 检查网关地址是否正确
3. 查看 Worker 日志

### Q16: 节点状态离线

- 检查心跳是否正常
- 默认 30 秒超时自动标记离线
- 查看网络连接

---

## 日志位置

- Gateway: `logs/gateway.log`
- Worker: `logs/worker-{engine}.log`

开启调试日志:
```bash
python -m src.main gateway --log-level DEBUG
```

---

## 获取帮助

- 查看日志文件
- 检查 [API 文档](05-API参考.md)
- 提交 Issue
