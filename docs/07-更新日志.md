# 07 更新日志

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/)

---

## [3.2.0] - 2025-11-30

### 安全修复
- **CORS 配置**: 移除通配符 `*`，改为指定具体域名
- **Docker 安全**: 添加非 root 用户 (`appuser`)
- **异常处理**: 修复裸 `except` 子句，添加具体异常类型和日志

### 改进
- 更新 README.md 匹配 v3 目录结构
- 修正 pyproject.toml 包路径配置 (`production` → `src`)
- 统一版本号为 3.2.0
- Python 版本约束改为 `>=3.10` (移除上限)
- 降低 GPU 显存使用比例 0.8 → 0.6

### 测试改进
- 修复 asyncio 事件循环问题 (Python 3.10+ 兼容)
- 添加 worker fixture 资源清理
- 修复 fixture 反模式，使用 `pytest.skip()` 替代 None 检查
- 使用 `.value` 进行 Enum 显式比较

---

## [3.1.0] - 2025-11-30

### 新增
- 优雅关闭机制 (`register_cleanup()`)
- 信号处理 (SIGINT, SIGTERM)
- 文档整合和编号体系

### 改进
- 更新 CLAUDE.md 开发指南
- 统一路径配置到 `common/paths.py`

---

## [3.0.0] - 2025-11-29

### 新增
- **微服务架构**: Gateway + Workers 分离
- **服务注册发现**: ServiceRegistry
- **负载均衡**: round_robin, least_load, random
- **限流系统**: TokenBucket + SlidingWindowCounter
- **WebSocket**: 实时状态推送
- **Web 页面**: /status, /admin, /playground

### 变更
- 代码重构到 `voice-clone-tts/src/`
- 配置统一到 `config.yaml`

---

## [2.1.1] - 2025-11-29

### 修复
- 音频预处理参数名冲突 (`remove_silence` → `do_remove_silence`)

---

## [2.1.0] - 2025-11-28

### 新增
- 流式合成 API (`/synthesize_stream`)
- 批量合成 API (`/synthesize_batch`)
- 音频预处理 API (`/preprocess`)
- OpenAPI 文档 (`/docs`)

### 修复
- NumPy 与 pandas 版本兼容
- OpenVoice FFmpeg 路径

---

## [2.0.0] - 2025-11-28

### 新增
- 工程化支持 (pyproject.toml, config.yaml)
- HTTP API 服务 (FastAPI)
- CLI 工具 (extract, synthesize, serve)
- Docker 支持

### 核心功能
- 统一引擎抽象层 `VoiceClonerBase`
- 三引擎: XTTS-v2, OpenVoice, GPT-SoVITS

---

## [1.0.0] - 2025-11-27

### 初始版本
- 基础音色克隆框架
- 三引擎实现
- 验证报告

---

## 版本号规则

`MAJOR.MINOR.PATCH`

- **MAJOR**: 不兼容的 API 变更
- **MINOR**: 向后兼容的功能新增
- **PATCH**: 向后兼容的问题修复

---

## 引擎状态

| 引擎 | 状态 | 推荐场景 |
|------|------|---------|
| XTTS-v2 | 生产就绪 | 多语言、快速部署 |
| OpenVoice | 生产就绪 | 音色转换 |
| GPT-SoVITS | 需独立部署 | 中文高质量 |

---

## 核心依赖版本

```
Python==3.10.x
torch>=2.0.0
TTS>=0.22.0
transformers<4.50
fastapi>=0.104.0
uvicorn>=0.24.0
```
