# ============================================================
# Voice Clone TTS 配置文件
# v3.1 微服务架构
# ============================================================

# 网关配置
gateway:
  host: "0.0.0.0"            # 监听地址
  port: 8080                 # 监听端口
  global_rpm: 1000           # 全局每分钟请求数限制
  ip_rpm: 100                # 单 IP 每分钟请求数限制
  concurrent_limit: 50       # 并发请求限制
  heartbeat_interval: 10     # 心跳间隔（秒）
  dead_threshold: 30         # 节点死亡阈值（秒）

# 工作节点配置
workers:
  # XTTS-v2 引擎配置
  xtts:
    port: 8001               # 默认端口
    model_path: ""           # 模型路径，留空使用默认 (packages/models/xtts_v2/extracted)
    device: "cuda"           # 设备: cuda, cpu
    use_deepspeed: false     # 是否使用 DeepSpeed 加速
    compute_type: "float16"  # 计算精度: float16, float32

  # OpenVoice 引擎配置
  openvoice:
    port: 8002               # 默认端口
    model_path: ""           # 模型路径，留空使用默认 (packages/models/openvoice/extracted)
    device: "cuda"           # 设备: cuda, cpu
    use_vad: true            # 是否使用 VAD 切分

  # GPT-SoVITS 引擎配置 (代理模式)
  gpt_sovits:
    port: 8003               # 默认端口
    api_url: "http://127.0.0.1:9880"  # GPT-SoVITS API 服务地址
    timeout: 60              # 请求超时（秒）

# 目录配置
paths:
  voices_dir: "./voices"     # 音色存储目录
  output_dir: "./outputs"    # 输出文件目录
  temp_dir: "./temp"         # 临时文件目录
  log_dir: "./logs"          # 日志目录

# 音频配置
audio:
  sample_rate: 24000         # 采样率 (XTTS 输出 24000)
  format: "wav"              # 默认输出格式
  max_duration: 300          # 最大音频时长（秒）
  min_duration: 1            # 最小参考音频时长（秒）

# 日志配置
logging:
  level: "INFO"              # 日志级别: DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file:
    enabled: true            # 是否输出到文件
    max_size: "10MB"         # 单个日志文件最大大小
    backup_count: 5          # 保留的日志文件数量
  console:
    enabled: true            # 是否输出到控制台
    color: true              # 是否使用彩色输出

# 安全配置
security:
  cors:
    enabled: true
    origins: ["*"]           # 允许的源
  rate_limit:
    enabled: true
    global_rpm: 1000         # 全局每分钟请求数
    ip_rpm: 100              # 单 IP 每分钟请求数

# 性能配置
performance:
  batch_size: 1              # 批处理大小
  num_threads: 4             # CPU 线程数
  gpu_memory_fraction: 0.8   # GPU 显存使用比例

# ============================================================
# 环境变量覆盖
# 以下环境变量可以覆盖配置文件中的设置:
#
# GATEWAY_HOST           - 网关地址
# GATEWAY_PORT           - 网关端口
# WORKER_PORT            - 工作节点端口
# VOICES_DIR             - 音色目录
# OUTPUT_DIR             - 输出目录
# MODEL_PATH             - 模型路径
# DEVICE                 - 计算设备 (cuda/cpu)
# LOG_LEVEL              - 日志级别
# GPT_SOVITS_API_URL     - GPT-SoVITS API 地址
# ============================================================
